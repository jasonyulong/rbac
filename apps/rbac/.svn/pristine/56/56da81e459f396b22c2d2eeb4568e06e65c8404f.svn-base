<?php
// +----------------------------------------------------------------------
// | 用户数据同步
// +----------------------------------------------------------------------
// | Copyright (c) 2019 http://www.jeoshi.com All rights reserved.
// +----------------------------------------------------------------------
// | Author: kevin
// +----------------------------------------------------------------------

namespace app\command\toerp;

use think\console\Input;
use think\console\Output;
use think\Config;
use think\Log;

class Users
{
    /**
     * 输入对象
     * @var Input
     */
    private $input;

    /**
     * 输出对象
     * @var Output
     */
    private $output;

    /**
     * 构造函数
     * Orders constructor.
     * @param Input $input 输入对象
     * @param Output $output 输出对象
     */
    public function __construct(Input $input, Output $output)
    {
        $this->input = $input;
        $this->output = $output;
    }

    /**
     * 开始同步用户数据
     */
    public function sync()
    {
        $start = strtotime("-10 minute");
        $model = new \app\common\model\Users();

        $users = $model->where('createtime|updatetime', 'EGT', $start)->select();
        if (count($users) <= 0) {
            $this->output->writeln("sync users total:" . count($users));
        }

        foreach ($users as $user) {
            $allows = $user->allows->toArray() ?? [];
            $module_ids = $allows ? array_column($allows, 'module_id') : [];


        }
    }
}